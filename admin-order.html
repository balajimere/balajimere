<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Orders</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{--green:#03A64A;--red:#e53935;--blue:#1976d2}
body{margin:0;font-family:Arial;background:#f4f4f4}

header{
 background:var(--green);
 color:#fff;
 text-align:center;
 padding:14px;
 font-size:20px;
 font-weight:bold
}

.orders{
 padding:10px;
 margin-bottom:80px
}

.card{
 background:#fff;
 border-radius:10px;
 padding:10px;
 margin-bottom:10px;
 box-shadow:0 2px 5px rgba(0,0,0,.1)
}

.card h3{
 margin:0 0 6px;
 font-size:16px
}

.small{font-size:13px;color:#555}

.products{
 margin:6px 0;
 font-size:14px
}

.products div{
 display:flex;
 justify-content:space-between
}

.status{
 margin-top:6px;
 font-weight:bold
}

select{
 width:100%;
 padding:6px;
 margin-top:6px
}

.actions{
 display:flex;
 gap:6px;
 margin-top:6px
}

.actions button{
 flex:1;
 padding:8px;
 border:none;
 border-radius:6px;
 color:#fff;
 cursor:pointer
}

.update{background:var(--blue)}
.delete{background:var(--red)}

.empty{
 text-align:center;
 padding:20px;
 color:#777
}
</style>
</head>

<body>

<header>Admin Orders Panel</header>

<div class="orders" id="orders"></div>

<script>
/* ADMIN CHECK */
if(localStorage.getItem("admin")!=="true"){
 location.href="login.html";
}

/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyCt99elKr4T1OJihGpQ6t2luYmCmEBJeo0",
  authDomain: "balajimere-c8eb9.firebaseapp.com",
  projectId: "balajimere-c8eb9"
});
const db=firebase.firestore();

/* LOAD ORDERS */
db.collection("orders")
.orderBy("time","desc")
.onSnapshot(snap=>{
 let box=document.getElementById("orders");
 box.innerHTML="";

 if(snap.empty){
  box.innerHTML=`<div class="empty">No orders found</div>`;
 }

 snap.forEach(doc=>{
  let o=doc.data();
  let pid=doc.id;

  let products="";
  o.products.forEach(p=>{
   products+=`
    <div>
     <span>${p.name} × ${p.qty}</span>
     <span>₹${p.price*p.qty}</span>
    </div>
   `;
  });

  box.innerHTML+=`
  <div class="card">
   <h3>${o.user.name} (${o.user.mobile})</h3>
   <div class="small">${o.user.shop}<br>${o.user.address}</div>

   <div class="products">${products}</div>

   <div class="status">Total: ₹${o.total}</div>
   <div class="status">Status: ${o.status}</div>

   <select id="st_${pid}">
    <option ${o.status=="Pending"?"selected":""}>Pending</option>
    <option ${o.status=="Accepted"?"selected":""}>Accepted</option>
    <option ${o.status=="Dispatched"?"selected":""}>Dispatched</option>
    <option ${o.status=="Delivered"?"selected":""}>Delivered</option>
    <option ${o.status=="Cancelled"?"selected":""}>Cancelled</option>
   </select>

   <div class="actions">
    <button class="update" onclick="updateStatus('${pid}')">
     Update
    </button>
    <button class="delete" onclick="deleteOrder('${pid}')">
     Delete
    </button>
   </div>
  </div>
  `;
 });
});

/* UPDATE STATUS */
function updateStatus(id){
 let st=document.getElementById("st_"+id).value;
 db.collection("orders").doc(id).update({status:st});
 alert("Status updated");
}

/* DELETE ORDER */
function deleteOrder(id){
 if(confirm("Delete this order?")){
  db.collection("orders").doc(id).delete();
 }
}
</script>

</body>
</html>
