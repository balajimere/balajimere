<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Status Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;margin:0}
header{background:#03A64A;color:#fff;padding:12px;text-align:center;font-size:18px}
.card{background:#fff;margin:12px;padding:12px;border-radius:10px}
input,textarea,button,select{width:100%;padding:8px;margin-top:8px}
.status{border-bottom:1px solid #ddd;padding:8px 0}
img{max-width:100%;border-radius:6px;margin-top:5px}
</style>
</head>

<body>

<header>Status Admin Panel</header>

<div class="card" id="loginBox">
  <h3>Admin Login</h3>
  <input id="email" placeholder="Admin Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="panel" style="display:none">

<div class="card">
  <!-- ✅ CATEGORY CREATE -->
  <input id="newCategory" placeholder="Create New Category">
  <button onclick="addCategory()">Add Category</button>

  <select id="category"></select>

  <textarea id="text" placeholder="Type status text..."></textarea>

  <!-- ✅ IMAGE FILE UPLOAD -->
  <input type="file" id="photo" multiple>

  <input id="link" placeholder="Clickable Link (optional)">

  <button onclick="addStatus()">Add Status</button>
</div>

<div class="card" id="list"></div>

<button onclick="logout()" style="margin:12px;background:red;color:white">Logout</button>

</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCt99elKr4T1OJihGpQ6t2luYmCmEBJeo0",
  authDomain:"balajimere-c8eb9.firebaseapp.com",
  projectId:"balajimere-c8eb9"
});

const auth=firebase.auth();
const db=firebase.firestore();
const ADMIN_EMAIL="balajimere.admin@gmail.com";
const IMGBB_KEY="5e77bfe737324a6c147697a13fefcb3d";

/* LOGIN */
function login(){
 auth.signInWithEmailAndPassword(email.value,password.value);
}
function logout(){
 auth.signOut();
}

auth.onAuthStateChanged(u=>{
 if(u && u.email===ADMIN_EMAIL){
  loginBox.style.display="none";
  panel.style.display="block";
  loadCategories();
 }else{
  panel.style.display="none";
  loginBox.style.display="block";
 }
});

/* CATEGORY */
async function addCategory(){
 let c=newCategory.value.trim();
 if(!c) return alert("Enter category name");
 await db.collection("statusCategories").doc(c).set({name:c});
 newCategory.value="";
}
function loadCategories(){
 db.collection("statusCategories").onSnapshot(s=>{
  category.innerHTML="";
  s.forEach(d=>{
   category.innerHTML+=`<option value="${d.id}">${d.id}</option>`;
  });
 });
}

/* ADD STATUS */
async function addStatus(){
 if(!text.value) return alert("Enter status text");

 let urls=[];

 let files=document.getElementById("photo").files;
 if(files.length>0){
  for(let f of files){
   let fd=new FormData();
   fd.append("image",f);

   let res=await fetch("https://api.imgbb.com/1/upload?key="+IMGBB_KEY,{
     method:"POST",
     body:fd
   });

   let json=await res.json();
   if(json.data && json.data.url){
     urls.push(json.data.url);
   }
  }
 }

 await db.collection("status").add({
  category:category.value,
  text:text.value,
  images:urls,
  link:link.value||"",
  time:new Date()
 });

 text.value="";
 link.value="";
 photo.value="";
}

/* LIST STATUS */
db.collection("status").orderBy("time","desc").onSnapshot(s=>{
 list.innerHTML="";
 s.forEach(d=>{
  let st=d.data();
  let imgs="";
  if(st.images){
    st.images.forEach(i=>{
      imgs+=`<img src="${i}">`;
    });
  }

  list.innerHTML+=`
   <div class="status">
    <b>${st.category}</b><br>
    ${st.text}<br>
    ${imgs}
    ${st.link?`<a href="${st.link}" target="_blank">Open Link</a><br>`:""}
    <button onclick="del('${d.id}')">Delete</button>
   </div>
  `;
 });
});

function del(id){
 if(confirm("Delete status?"))
  db.collection("status").doc(id).delete();
}
</script>

</body>
</html>
