<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shree Balaji Oil Agency</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{--red:#F21D44;--green:#03A64A;}
body{margin:0;font-family:Arial;background:#f7f7f7}
header{background:var(--green);color:#fff;text-align:center;padding:14px;font-size:20px;font-weight:bold}
.products{padding:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-bottom:90px}
.card{background:#fff;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1);overflow:hidden}
.slider img{width:100%;height:200px;object-fit:cover}
.info{padding:10px}
.price{color:var(--green);font-weight:bold}
.mrp{text-decoration:line-through;color:#999;font-size:13px}
.desc{font-size:13px;color:#555;margin:6px 0}
.actions button{width:100%;margin-top:6px;padding:8px;border:none;border-radius:6px;color:#fff;cursor:pointer}
.order{background:var(--green)}
.cart{background:#ff9800}
.view{background:#607d8b}
.share{background:#555}
.comment{width:100%;margin-top:6px;padding:6px}
.bottom-nav{position:fixed;bottom:0;left:0;width:100%;background:#fff;border-top:1px solid #ddd;display:flex;justify-content:space-around;padding:8px 0}
.bottom-nav i{font-size:22px;color:var(--green)}
.admin{display:none}
</style>
</head>

<body>

<header>Shree Balaji Oil Agency</header>

<div class="products" id="productList"></div>

<!-- ADMIN PANEL (HIDDEN) -->
<div class="admin" id="adminPanel"></div>

<!-- BOTTOM MENU -->
<div class="bottom-nav">
  <i class="fa-solid fa-box" onclick="location.href='order.html'"></i>
  <i class="fa-solid fa-user" onclick="location.href='login.html'"></i>
  <i class="fa-solid fa-cart-shopping" onclick="location.href='cart.html'"></i>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCt99elKr4T1OJihGpQ6t2luYmCmEBJeo0",
  authDomain: "balajimere-c8eb9.firebaseapp.com",
  projectId: "balajimere-c8eb9",
  storageBucket: "balajimere-c8eb9.appspot.com",
  messagingSenderId: "354355662744",
  appId: "1:354355662744:web:dc4879a69dc77d2dc1e5ed"
});

const db=firebase.firestore();
const IMGBB_API_KEY="5e77bfe737324a6c147697a13fefcb3d";

/* LOAD PRODUCTS */
db.collection("products").onSnapshot(snap=>{
 productList.innerHTML="";
 snap.forEach(doc=>{
  let p=doc.data();
  let imgs=p.images||[p.imageUrl];
  productList.innerHTML+=`
  <div class="card">
    <div class="slider">
      <img src="${imgs[0]}" onclick="view('${doc.id}')">
    </div>
    <div class="info">
      <b>${p.name}</b><br>
      <span class="price">₹${p.price}</span>
      <span class="mrp">₹${p.mrp||""}</span>
      <div class="desc">${p.description||""}</div>

      <div class="actions">
        <button class="order" onclick="order('${p.name}')">Order</button>
        <button class="cart" onclick='addCart(${JSON.stringify(p)}, "${doc.id}")'>Add to Cart</button>
        <button class="view" onclick="view('${doc.id}')">View Product</button>
        <button class="share" onclick="share('${p.name}')">Share</button>
        <input class="comment" placeholder="Comment..." onkeydown="comment(event,'${doc.id}',this.value)">
      </div>
    </div>
  </div>`;
 });
});

/* CART */
function addCart(p,id){
 let c=JSON.parse(localStorage.getItem("cart")||"[]");
 c.push({...p,id});
 localStorage.setItem("cart",JSON.stringify(c));
 alert("Added to cart");
}

/* COMMENT */
function comment(e,id,text){
 if(e.key==="Enter"){
  db.collection("products").doc(id).collection("comments").add({text,time:new Date()});
  e.target.value="";
 }
}

/* ORDER */
function order(name){
 location.href="order.html?product="+encodeURIComponent(name);
}

/* SHARE */
function share(name){
 navigator.share?
 navigator.share({title:name,text:name,url:location.href}):
 window.open(`https://wa.me/?text=${name}`);
}

/* VIEW */
function view(id){
 location.href="view-product.html?id="+id;
}
</script>

</body>
</html>
