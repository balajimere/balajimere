<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shree Balaji Oil Agency</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --red:#F21D44;
  --green:#03A64A;
}
body{
  margin:0;
  font-family:Arial;
  background:#f7f7f7;
}
header{
  background:var(--green);
  color:#fff;
  text-align:center;
  padding:14px;
  font-size:20px;
  font-weight:bold;
}
.products{
  padding:12px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
  gap:12px;
  margin-bottom:80px;
}
.card{
  background:#fff;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  overflow:hidden;
}
.card img{
  width:100%;
  height:170px;
  object-fit:cover;
}
.card .info{
  padding:10px;
}
.price{color:var(--green);font-weight:bold}
.actions button{
  width:100%;
  margin-top:6px;
  padding:8px;
  border:none;
  border-radius:6px;
  color:#fff;
  cursor:pointer;
}
.order{background:var(--green)}
.share{background:#555}
.delete{background:var(--red)}
.comment{
  width:100%;
  margin-top:6px;
  padding:6px;
}
.admin{
  background:#fff;
  margin:10px;
  padding:10px;
  border-radius:10px;
  display:none;
}
.bottom-nav{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#fff;
  border-top:1px solid #ddd;
  display:flex;
  justify-content:space-around;
  padding:8px 0;
}
.bottom-nav i{
  font-size:22px;
  color:var(--green);
}
</style>
</head>

<body>

<header>Shree Balaji Oil Agency</header>

<!-- PRODUCTS -->
<div class="products" id="productList"></div>

<!-- ADMIN PANEL -->
<div class="admin" id="adminPanel">
  <h3>Admin Panel</h3>
  <input id="email" placeholder="Admin Email"><br><br>
  <input id="password" type="password" placeholder="Password"><br><br>
  <button onclick="login()">Login</button>
  <button onclick="logout()">Logout</button>
  <hr>
  <input id="pname" placeholder="Product Name"><br><br>
  <input id="price" placeholder="Price"><br><br>
  <input type="file" id="image"><br><br>
  <button onclick="addProduct()">Add Product</button>
</div>

<!-- BOTTOM MENU -->
<div class="bottom-nav">
  <i class="fa-solid fa-box" onclick="location.href='order.html'"></i>
  <i class="fa-solid fa-user" onclick="location.href='login.html'"></i>
  <i class="fa-solid fa-cart-shopping" onclick="location.href='cart.html'"></i>
</div>

<script>
/* ðŸ”¥ Firebase Config */
firebase.initializeApp({
  apiKey: "AIzaSyCt99elKr4T1OJihGpQ6t2luYmCmEBJeo0",
  authDomain: "balajimere-c8eb9.firebaseapp.com",
  projectId: "balajimere-c8eb9",
  storageBucket: "balajimere-c8eb9.appspot.com",
  messagingSenderId: "354355662744",
  appId: "1:354355662744:web:dc4879a69dc77d2dc1e5ed"
});

const db = firebase.firestore();
const auth = firebase.auth();
const IMGBB_API_KEY="5e77bfe737324a6c147697a13fefcb3d";
let admin=false;

/* AUTH */
function login(){
 auth.signInWithEmailAndPassword(email.value,password.value);
}
function logout(){auth.signOut();}
auth.onAuthStateChanged(u=>{
 admin=!!u;
 adminPanel.style.display=admin?"block":"none";
 loadProducts();
});

/* LOAD PRODUCTS */
function loadProducts(){
 db.collection("products").onSnapshot(snap=>{
  productList.innerHTML="";
  snap.forEach(doc=>{
    let p=doc.data();
    productList.innerHTML+=`
    <div class="card">
      <img src="${p.imageUrl}">
      <div class="info">
        <b>${p.name}</b>
        <div class="price">â‚¹${p.price}</div>
        <div class="actions">
          <button class="order" onclick="order('${p.name}')">Order</button>
          <button class="share" onclick="share('${p.name}')">Share</button>
          ${admin?`<button class="delete" onclick="del('${doc.id}')">Delete</button>`:""}
          <input class="comment" placeholder="Comment..." onkeydown="comment(event,'${doc.id}',this.value)">
        </div>
      </div>
    </div>`;
  });
 });
}

/* ADD PRODUCT */
function addProduct(){
 let f=image.files[0];
 let fd=new FormData();
 fd.append("image",f);
 fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`,{method:"POST",body:fd})
 .then(r=>r.json()).then(d=>{
   db.collection("products").add({
     name:pname.value,
     price:price.value,
     imageUrl:d.data.url
   });
 });
}

/* DELETE */
function del(id){ if(confirm("Delete?")) db.collection("products").doc(id).delete(); }

/* COMMENT */
function comment(e,id,text){
 if(e.key==="Enter"){
   db.collection("products").doc(id).collection("comments").add({
     text:text,
     time:new Date()
   });
   e.target.value="";
 }
}

/* ORDER */
function order(name){
 window.location="order.html?product="+encodeURIComponent(name);
}

/* SHARE */
function share(name){
 navigator.share?
 navigator.share({title:name,text:name,url:location.href}):
 window.open(`https://wa.me/?text=${name}`);
}

loadProducts();
</script>

</body>
</html>
