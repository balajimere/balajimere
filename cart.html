<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Cart – Shree Balaji Oil Agency</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
header{background:#03A64A;color:#fff;padding:14px;text-align:center;font-size:20px;font-weight:bold}
.cart{padding:12px}
.card{
 background:#fff;
 border-radius:12px;
 padding:12px;
 margin-bottom:12px;
 box-shadow:0 2px 6px rgba(0,0,0,.1)
}
.flex{display:flex;justify-content:space-between;align-items:center}
.qty button{
 width:28px;height:28px;border:none;border-radius:6px;
 background:#03A64A;color:#fff;font-size:16px
}
.total{
 font-size:18px;font-weight:bold;text-align:right;margin-top:10px
}
.btn{
 width:100%;
 padding:12px;
 border:none;
 border-radius:8px;
 background:#03A64A;
 color:#fff;
 font-size:16px;
 margin-top:10px
}
.bottom{
 position:fixed;bottom:0;width:100%;
 background:#fff;display:flex;
 justify-content:space-around;padding:10px 0;
 box-shadow:0 -2px 6px rgba(0,0,0,.2)
}
.bottom i{font-size:22px;color:#555}
.space{height:70px}
</style>
</head>

<body>

<header>My Cart</header>

<div class="cart" id="cartList"></div>

<div class="cart">
 <div class="total" id="total"></div>
 <button class="btn" onclick="placeOrder()">Place Order</button>
</div>

<div class="space"></div>

<div class="bottom">
 <a href="home.html"><i class="fa fa-home"></i></a>
 <a href="cart.html"><i class="fa fa-shopping-cart"></i></a>
 <a href="order.html"><i class="fa fa-box"></i></a>
</div>

<script>
firebase.initializeApp({
 apiKey: "AIzaSyCt99elKr4T1OJihGpQ6t2luYmCmEBJeo0",
 authDomain: "balajimere-c8eb9.firebaseapp.com",
 projectId: "balajimere-c8eb9"
});
const db = firebase.firestore();

let cart = JSON.parse(localStorage.getItem("cart") || "[]");

/* LOAD CART */
function loadCart(){
 cartList.innerHTML="";
 let sum=0;

 if(cart.length==0){
  cartList.innerHTML="<p>Cart is empty</p>";
  total.innerHTML="";
  return;
 }

 cart.forEach((p,i)=>{
  sum += p.price * p.qty;
  cartList.innerHTML += `
  <div class="card">
   <div class="flex">
    <b>${p.name}</b>
    <span>₹${p.price}</span>
   </div>
   <div class="flex">
    <div class="qty">
     <button onclick="changeQty(${i},-1)">−</button>
     <span style="margin:0 10px">${p.qty}</span>
     <button onclick="changeQty(${i},1)">+</button>
    </div>
    <button onclick="remove(${i})">❌</button>
   </div>
  </div>`;
 });

 total.innerHTML = "Total : ₹" + sum;
}

/* QTY */
function changeQty(i,v){
 cart[i].qty += v;
 if(cart[i].qty<=0) cart.splice(i,1);
 save();
}

/* REMOVE */
function remove(i){
 cart.splice(i,1);
 save();
}

/* SAVE */
function save(){
 localStorage.setItem("cart",JSON.stringify(cart));
 loadCart();
}

/* PLACE ORDER */
function placeOrder(){
 if(cart.length==0) return alert("Cart empty");

 let name = prompt("Your Name");
 let mobile = prompt("Mobile Number");
 if(!name || !mobile) return;

 cart.forEach(p=>{
  db.collection("orders").add({
   product:p.name,
   price:p.price,
   qty:p.qty,
   name:name,
   mobile:mobile,
   time:new Date()
  });
 });

 localStorage.removeItem("cart");
 alert("Order Placed Successfully");
 location.href="order.html";
}

loadCart();
</script>

</body>
</html>
