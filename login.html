<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login ‚Äì Shree Balaji Oil Agency</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{--green:#03A64A;--red:#F21D44}
body{
 margin:0;
 font-family:Arial;
 background:#f4f6f8;
 display:flex;
 height:100vh
}
.menu{
 width:60px;
 background:#03A64A;
 display:flex;
 justify-content:center;
 padding-top:20px
}
.menu button{
 background:#fff;
 border:none;
 border-radius:50%;
 width:42px;
 height:42px;
 cursor:pointer;
 font-size:18px
}
.main{
 flex:1;
 display:flex;
 justify-content:center;
 align-items:center
}
.card{
 background:#fff;
 width:92%;
 max-width:380px;
 padding:20px;
 border-radius:14px;
 box-shadow:0 4px 10px rgba(0,0,0,.15)
}
h2{text-align:center;color:var(--green)}
input,button{
 width:100%;
 padding:12px;
 margin-top:10px;
 border-radius:8px;
 border:1px solid #ccc;
 font-size:15px
}
button{
 background:var(--green);
 border:none;
 color:#fff;
 cursor:pointer
}
button.red{background:var(--red)}
.small{text-align:center;font-size:13px;color:#777;margin-top:10px}
.hide{display:none}
.profile{text-align:center}
.profile img{
 width:90px;height:90px;border-radius:50%;
 object-fit:cover;border:2px solid #03A64A
}
.bottom{
 position:fixed;bottom:0;left:0;right:0;
 background:#fff;border-top:1px solid #ccc;
 padding:8px;text-align:center
}
</style>
</head>

<body>

<div class="menu">
 <button onclick="goHome()">üè†</button>
</div>

<div class="main">
<div class="card">

<h2>Shree Balaji Oil Agency</h2>

<div id="loginBox">
 <input id="loginMobile" placeholder="Enter Mobile Number" maxlength="10">
 <button onclick="checkLogin()">Login</button>
</div>

<div id="registerBox" class="hide">
 <div class="profile">
   <img id="photoPreview" src="https://via.placeholder.com/100">
   <input type="file" id="photo" accept="image/*">
 </div>

 <input id="name" placeholder="Name">
 <input id="mobile" placeholder="Mobile Number" maxlength="10">
 <input id="shop" placeholder="Shop Name">
 <input id="address" placeholder="Address">

 <button onclick="saveUser()">Save</button>
 <button class="red" onclick="back()">Back</button>
</div>

<p class="small">No OTP ‚Ä¢ No Password ‚Ä¢ Fast Login</p>

</div>
</div>

<div class="bottom">
 <button onclick="goHome()">üè† Home</button>
</div>

<script>
firebase.initializeApp({
 apiKey: "AIzaSyCt99elKr4T1OJihGpQ6t2luYmCmEBJeo0",
 authDomain: "balajimere-c8eb9.firebaseapp.com",
 projectId: "balajimere-c8eb9"
});

const db = firebase.firestore();

/* IMAGE API KEY */
const IMAGE_API_KEY = "5e77bfe737324a6c147697a13fefcb3d";

/* LOGIN */
async function checkLogin(){
 let m = loginMobile.value.trim();
 if(m.length!==10){ alert("Enter valid mobile"); return; }

 let doc = await db.collection("users").doc(m).get();
 if(doc.exists){
   showProfile(doc.data());
 }else{
   mobile.value = m;
   loginBox.classList.add("hide");
   registerBox.classList.remove("hide");
 }
}

/* SHOW PROFILE */
function showProfile(d){
 loginBox.classList.add("hide");
 registerBox.classList.remove("hide");

 name.value=d.name||"";
 mobile.value=d.mobile||"";
 shop.value=d.shop||"";
 address.value=d.address||"";
 if(d.photo) photoPreview.src=d.photo;
}

/* SAVE / UPDATE */
async function saveUser(){
 let n=name.value.trim();
 let m=mobile.value.trim();
 let s=shop.value.trim();
 let a=address.value.trim();
 if(!n||!m||!s||!a){ alert("Fill all details"); return; }

 let photoURL="";

 if(photo.files[0]){
   let fd=new FormData();
   fd.append("image",photo.files[0]);

   let res=await fetch(
     "https://api.imgbb.com/1/upload?key="+IMAGE_API_KEY,
     {method:"POST",body:fd}
   );
   let img=await res.json();
   photoURL=img.data.url;
   photoPreview.src=photoURL;
 }

 let data={name:n,mobile:m,shop:s,address:a,photo:photoURL,time:new Date()};
 await db.collection("users").doc(m).set(data,{merge:true});
 alert("Profile Saved / Updated");
}

/* HOME */
function goHome(){ location.href="home.html"; }

/* BACK */
function back(){
 registerBox.classList.add("hide");
 loginBox.classList.remove("hide");
}
</script>

</body>
</html>
