<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login – Shree Balaji Oil Agency</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{--green:#03A64A;--red:#F21D44}
body{
 margin:0;
 font-family:Arial;
 background:#f4f6f8;
 display:flex;
 justify-content:center;
 align-items:center;
 height:100vh
}
.card{
 background:#fff;
 width:92%;
 max-width:380px;
 padding:20px;
 border-radius:14px;
 box-shadow:0 4px 10px rgba(0,0,0,.15)
}
h2{text-align:center;color:var(--green)}
input,button{
 width:100%;
 padding:12px;
 margin-top:10px;
 border-radius:8px;
 border:1px solid #ccc;
 font-size:15px
}
button{
 background:var(--green);
 border:none;
 color:#fff;
 cursor:pointer
}
button.red{background:var(--red)}
.small{text-align:center;font-size:13px;color:#777;margin-top:10px}
.hide{display:none}
.profile-img{
 width:100px;
 height:100px;
 border-radius:50%;
 object-fit:cover;
 display:block;
 margin:10px auto;
 border:2px solid #03A64A
}
</style>
</head>

<body>

<div class="card">
<h2>Shree Balaji Oil Agency</h2>

<!-- LOGIN -->
<div id="loginBox">
 <input id="loginMobile" placeholder="Enter Mobile Number" maxlength="10">
 <button onclick="checkLogin()">Login</button>
</div>

<!-- REGISTER / PROFILE -->
<div id="registerBox" class="hide">

 <img id="profilePreview" class="profile-img" src="https://via.placeholder.com/100">
 <input type="file" id="photo" accept="image/*">

 <input id="name" placeholder="Name">
 <input id="mobile" placeholder="Mobile Number" maxlength="10">
 <input id="shop" placeholder="Shop Name">
 <input id="address" placeholder="Address">

 <button onclick="saveUser()">Save</button>
 <button class="red" onclick="logout()">Logout</button>
</div>

<p class="small">No OTP • No Password • Fast Login</p>
</div>

<script>
firebase.initializeApp({
 apiKey: "AIzaSyCt99elKr4T1OJihGpQ6t2luYmCmEBJeo0",
 authDomain: "balajimere-c8eb9.firebaseapp.com",
 projectId: "balajimere-c8eb9"
});

const db = firebase.firestore();
let uploadedPhotoURL="";

/* ✅ FIX: GET INPUT ELEMENTS */
const nameInput = document.getElementById("name");
const mobileInput = document.getElementById("mobile");
const shopInput = document.getElementById("shop");
const addressInput = document.getElementById("address");
const photoInput = document.getElementById("photo");
const profilePreview = document.getElementById("profilePreview");

/* PHOTO PREVIEW */
photoInput.onchange = ()=>{
 let f = photoInput.files[0];
 if(f){
   profilePreview.src = URL.createObjectURL(f);
 }
}

/* CHECK LOGIN */
async function checkLogin(){
 let m = document.getElementById("loginMobile").value.trim();
 if(m.length!==10){ alert("Enter valid mobile"); return; }

 let doc = await db.collection("users").doc(m).get();

 if(doc.exists){
   localStorage.setItem("user",JSON.stringify(doc.data()));
   showProfile(doc.data());
 }else{
   mobileInput.value = m;
   loginBox.classList.add("hide");
   registerBox.classList.remove("hide");
 }
}

/* UPLOAD IMAGE */
async function uploadPhoto(){
 if(!photoInput.files[0]) return "";
 let formData = new FormData();
 formData.append("image", photoInput.files[0]);

 let res = await fetch("https://api.imgbb.com/1/upload?key=5e77bfe737324a6c147697a13fefcb3d",{
   method:"POST",
   body:formData
 });

 let data = await res.json();
 return data.data.url;
}

/* SAVE USER */
async function saveUser(){
 try{
   let n = nameInput.value.trim();
   let m = mobileInput.value.trim();
   let s = shopInput.value.trim();
   let a = addressInput.value.trim();

   if(!n || !m || !s || !a){
     alert("Fill all details");
     return;
   }

   if(photoInput.files[0]){
     uploadedPhotoURL = await uploadPhoto();
   }

   let data={
     name:n,
     mobile:m,
     shop:s,
     address:a,
     photo:uploadedPhotoURL,
     time:new Date()
   };

   await db.collection("users").doc(m).set(data,{merge:true});
   localStorage.setItem("user",JSON.stringify(data));

   alert("Profile Saved");
   location.href="home.html";

 }catch(e){
   alert("Error: " + e.message);
 }
}

/* SHOW PROFILE */
function showProfile(d){
 loginBox.classList.add("hide");
 registerBox.classList.remove("hide");

 nameInput.value = d.name || "";
 mobileInput.value = d.mobile || "";
 shopInput.value = d.shop || "";
 addressInput.value = d.address || "";
 if(d.photo) profilePreview.src = d.photo;
}

/* LOGOUT */
function logout(){
 localStorage.removeItem("user");
 location.reload();
}

/* AUTO LOAD PROFILE */
let u = localStorage.getItem("user");
if(u){
 showProfile(JSON.parse(u));
}
</script>

</body>
  </html>
