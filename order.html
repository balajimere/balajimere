<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Place Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;margin:0}
header{background:#03A64A;color:#fff;padding:12px;text-align:center;font-size:20px}
.box{background:#fff;margin:10px;padding:12px;border-radius:10px}
input,button{width:100%;padding:8px;margin:5px 0}
button{background:#03A64A;color:#fff;border:none;border-radius:6px;font-size:16px}
.order{border-bottom:1px dashed #ccc;padding:8px 0}
.status{font-weight:bold}
.pending{color:orange}
.done{color:green}
.dispatch{color:#f39c12}
.delivered{color:#2980b9}
.rejected{color:red}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<header>Place Order</header>

<div class="box">
<h3>ðŸ§‘ Customer Details</h3>
<input id="name" placeholder="Full Name">
<input id="mobile" placeholder="Mobile Number">
<input id="shop" placeholder="Shop Name">
<input id="address" placeholder="Address">
</div>

<div class="box">
<h3>ðŸ›’ Products</h3>

<input placeholder="Product Name" id="pname">
<input placeholder="Price" type="number" id="price">
<input placeholder="Qty" type="number" id="qty">
<button onclick="addItem()">âž• Add Item</button>

<div id="cart"></div>
<h3>Total: â‚¹<span id="total">0</span></h3>
<button onclick="placeOrder()">âœ… Place Order</button>
</div>

<div class="box">
<h3>ðŸ“¦ My Orders</h3>
<div id="orders"></div>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG (SAME AS ADMIN) */
firebase.initializeApp({
 apiKey:"AIzaSyCt99elKr4T1OJihGpQ6t2luYmCmEBJeo0",
 authDomain:"balajimere-c8eb9.firebaseapp.com",
 projectId:"balajimere-c8eb9"
});
const db = firebase.firestore();

let products = [];
let total = 0;

/* âž• ADD PRODUCT */
function addItem(){
 let name=pname.value;
 let price=Number(price.value);
 let qty=Number(qty.value);
 if(!name || !price || !qty) return alert("Fill product details");

 products.push({name,price,qty});
 total += price*qty;
 renderCart();

 pname.value=price.value=qty.value="";
}

function renderCart(){
 cart.innerHTML="";
 products.forEach(p=>{
  cart.innerHTML+=`
  <div class="order">
   ${p.name} Ã— ${p.qty} = â‚¹${p.price*p.qty}
  </div>`;
 });
 document.getElementById("total").innerText=total;
}

/* ðŸ§¾ PLACE ORDER */
async function placeOrder(){
 if(!name.value || !mobile.value) return alert("Enter name & mobile");

 let order={
  user:{
   name:name.value,
   mobile:mobile.value,
   shop:shop.value,
   address:address.value
  },
  products:products,
  total:total,
  status:"Pending",
  time:firebase.firestore.FieldValue.serverTimestamp()
 };

 await db.collection("orders").add(order);

 alert("âœ… Order Placed");
 sendWhatsApp();

 products=[]; total=0;
 renderCart();
}

/* ðŸ“² WHATSAPP ALERT */
function sendWhatsApp(){
 let msg=`ðŸ›’ New Order Placed
Name: ${name.value}
Mobile: ${mobile.value}
Total: â‚¹${total}`;
 window.open("https://wa.me/918959216904?text="+encodeURIComponent(msg));
}

/* ðŸ”´ LIVE ORDER STATUS */
db.collection("orders")
.where("user.mobile","==",mobile.value)
.orderBy("time","desc")
.onSnapshot(s=>{
 orders.innerHTML="";
 s.forEach(d=>{
  let o=d.data();
  orders.innerHTML+=`
  <div class="order">
   <b>Invoice:</b> ${o.invoice||"Pending"}<br>
   <span class="status ${o.status.toLowerCase()}">
    ${o.status}
   </span><br>
   <span class="small">â‚¹${o.total}</span><br>
   ${o.tracking?`Tracking: ${o.tracking}`:""}
  </div>`;
 });
});
</script>

</body>
</html>
