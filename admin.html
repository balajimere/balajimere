<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - Shree Balaji Oil Agency</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{--green:#03A64A;--red:#F21D44}
body{margin:0;font-family:Arial;background:#f4f6f8}
header{background:var(--green);color:#fff;padding:14px;text-align:center;font-size:20px;font-weight:bold}
.container{padding:14px}
.card{background:#fff;border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
input,textarea,button,select{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:1px solid #ccc}
button{border:none;background:var(--green);color:#fff;font-size:15px;cursor:pointer}
button.red{background:var(--red)}
.product{border-bottom:1px solid #eee;padding:8px 0}
.small{font-size:13px;color:#666}
.scroll{max-height:260px;overflow-y:auto}
</style>
</head>

<body>

<header>Admin Panel – Shree Balaji Oil Agency</header>

<div class="container">

<div class="card" id="loginBox">
  <h3>Admin Login</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="dashboard" style="display:none">

  <!-- CATEGORY -->
  <div class="card">
    <h3>Add Category</h3>
    <input id="catName" placeholder="Category Name">
    <button onclick="addCategory()">Add Category</button>
  </div>

  <!-- ADD PRODUCT -->
  <div class="card">
    <h3>Add Product</h3>

    <input type="hidden" id="pid">

    <select id="pcategory"></select>
    <input id="pname" placeholder="Product Name">
    <input id="pprice" placeholder="Price">
    <input id="pmrp" placeholder="MRP">
    <textarea id="pdesc" placeholder="Product Description"></textarea>
    <input type="file" id="images" multiple>

    <button onclick="addProduct()">Save Product</button>
  </div>

  <!-- PRODUCTS -->
  <div class="card">
    <h3>Products</h3>
    <div id="productList" class="scroll"></div>
  </div>

  <!-- USERS -->
  <div class="card">
    <h3>Users</h3>
    <div id="users" class="scroll"></div>
  </div>

  <!-- ORDERS -->
  <div class="card">
    <h3>Orders</h3>
    <div id="orders" class="scroll"></div>
  </div>

  <button class="red" onclick="logout()">Logout</button>

</div>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCt99elKr4T1OJihGpQ6t2luYmCmEBJeo0",
  authDomain: "balajimere-c8eb9.firebaseapp.com",
  projectId: "balajimere-c8eb9"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* LOGIN */
function login(){
 auth.signInWithEmailAndPassword(email.value,password.value);
}
function logout(){auth.signOut();}

auth.onAuthStateChanged(u=>{
 if(u && u.email==="balajimere.admin@gmail.com"){
  loginBox.style.display="none";
  dashboard.style.display="block";
  loadProducts(); loadOrders(); loadUsers(); loadCategories();
 }else{
  dashboard.style.display="none";
  loginBox.style.display="block";
 }
});

/* CATEGORY */
async function addCategory(){
 let c = catName.value.trim();
 if(!c) return;
 await db.collection("categories").doc(c).set({name:c});
 catName.value="";
}
function loadCategories(){
 db.collection("categories").onSnapshot(s=>{
  pcategory.innerHTML="";
  s.forEach(d=>{
   pcategory.innerHTML+=`<option value="${d.id}">${d.id}</option>`;
  });
 });
}

/* PRODUCT */
async function addProduct(){
 let data={
  category:pcategory.value,
  name:pname.value,
  price:pprice.value,
  mrp:pmrp.value,
  description:pdesc.value,
  time:new Date()
 };
 if(pid.value){
  await db.collection("products").doc(pid.value).update(data);
 }else{
  await db.collection("products").add(data);
 }
}

/* LOAD PRODUCTS */
function loadProducts(){
 db.collection("products").onSnapshot(s=>{
  productList.innerHTML="";
  s.forEach(d=>{
   let p=d.data();
   productList.innerHTML+=`
    <div class="product">
     <b>${p.name}</b><br>
     <span class="small">${p.category} | ₹${p.price}</span>
    </div>`;
  });
 });
}

/* USERS */
function loadUsers(){
 db.collection("users").onSnapshot(s=>{
  users.innerHTML="";
  s.forEach(d=>{
   let u=d.data();
   users.innerHTML+=`
    <div class="product">
     <b>${u.name}</b><br>
     <span class="small">${u.mobile} | ${u.shop}</span>
    </div>`;
  });
 });
}

/* ORDERS */
function loadOrders(){
 db.collection("orders").onSnapshot(s=>{
  orders.innerHTML="";
  s.forEach(d=>{
   let o=d.data();
   orders.innerHTML+=`
    <div class="product">
     <b>${o.product}</b><br>
     <span class="small">${o.name} | ${o.mobile}</span><br>
     <select onchange="updateOrder('${d.id}',this.value)">
      <option ${o.status==="Pending"?"selected":""}>Pending</option>
      <option ${o.status==="Confirmed"?"selected":""}>Confirmed</option>
      <option ${o.status==="Delivered"?"selected":""}>Delivered</option>
     </select>
    </div>`;
  });
 });
}
function updateOrder(id,status){
 db.collection("orders").doc(id).update({status:status});
}
</script>

</body>
</html>
