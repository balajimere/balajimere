<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - Shree Balaji Oil Agency</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{--green:#03A64A;--red:#F21D44}
body{margin:0;font-family:Arial;background:#f5f5f5}
header{background:var(--green);color:#fff;padding:14px;text-align:center;font-size:20px;font-weight:bold}
.card{background:#fff;margin:12px;padding:14px;border-radius:10px}
input,textarea,button{width:100%;padding:10px;margin-top:8px}
button{background:var(--green);border:none;color:#fff;border-radius:6px;cursor:pointer}
.red{background:var(--red)}
.product{border-bottom:1px solid #eee;padding:10px 0}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<header>Admin Panel – Shree Balaji Oil Agency</header>

<div class="card" id="loginBox">
  <h3>Admin Login</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password">
  <button onclick="login()">Login</button>
</div>

<div id="dashboard" style="display:none">

<div class="card">
  <h3>Add / Edit Product</h3>
  <input id="pid" hidden>
  <input id="name" placeholder="Product Name">
  <input id="price" placeholder="Price">
  <input id="mrp" placeholder="MRP">
  <textarea id="desc" placeholder="Description"></textarea>
  <input type="file" id="images" multiple>
  <button onclick="saveProduct()">Save Product</button>
</div>

<div class="card">
  <h3>Products</h3>
  <div id="productList"></div>
</div>

<button class="red" onclick="logout()">Logout</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCt99elKr4T1OJihGpQ6t2luYmCmEBJeo0",
  authDomain: "balajimere-c8eb9.firebaseapp.com",
  projectId: "balajimere-c8eb9",
  storageBucket: "balajimere-c8eb9.appspot.com",
  messagingSenderId: "354355662744",
  appId: "1:354355662744:web:dc4879a69dc77d2dc1e5ed"
});

const auth=firebase.auth();
const db=firebase.firestore();
const IMGBB="5e77bfe737324a6c147697a13fefcb3d";

/* LOGIN */
function login(){
 auth.signInWithEmailAndPassword(email.value,password.value);
}
function logout(){auth.signOut();}

auth.onAuthStateChanged(u=>{
 if(u && u.email==="balajimere.admin@gmail.com"){
   loginBox.style.display="none";
   dashboard.style.display="block";
   loadProducts();
 }else{
   dashboard.style.display="none";
   loginBox.style.display="block";
 }
});

/* SAVE PRODUCT */
async function saveProduct(){
 if(!name.value || !price.value){ alert("Fill all fields"); return; }

 let urls=[];
 if(images.files.length>0){
  for(let f of images.files){
   let fd=new FormData();
   fd.append("image",f);
   let r=await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB}`,{method:"POST",body:fd});
   let j=await r.json();
   urls.push(j.data.url);
  }
 }

 let data={
  name:name.value,
  price:price.value,
  mrp:mrp.value,
  description:desc.value,
  images:urls,
  imageUrl:urls[0]||"",
  time:new Date()
 };

 if(pid.value){
   await db.collection("products").doc(pid.value).update(data);
   alert("Product Updated");
 }else{
   await db.collection("products").add(data);
   alert("Product Added");
 }
 clearForm();
}

/* LOAD PRODUCTS */
function loadProducts(){
 db.collection("products").orderBy("time","desc").onSnapshot(s=>{
  productList.innerHTML="";
  s.forEach(d=>{
   let p=d.data();
   productList.innerHTML+=`
   <div class="product">
     <b>${p.name}</b><br>
     <span class="small">₹${p.price} | MRP ₹${p.mrp}</span><br>
     <button onclick="edit('${d.id}','${p.name}','${p.price}','${p.mrp}','${p.description||""}')">Edit</button>
     <button class="red" onclick="del('${d.id}')">Delete</button>
   </div>`;
  });
 });
}

/* EDIT */
function edit(id,n,pr,mr,d){
 pid.value=id;
 name.value=n;
 price.value=pr;
 mrp.value=mr;
 desc.value=d;
 window.scrollTo(0,0);
}

/* DELETE */
function del(id){
 if(confirm("Delete product?"))
  db.collection("products").doc(id).delete();
}

function clearForm(){
 pid.value="";
 name.value="";
 price.value="";
 mrp.value="";
 desc.value="";
 images.value="";
}
</script>

</body>
</html>
